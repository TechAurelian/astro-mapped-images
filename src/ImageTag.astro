---
import type { HTMLAttributes } from 'astro/types';
import { getImageData, getImageUrl } from './utils';
// @ts-ignore: The local image map should be available in the Astro site that uses this integration
import localImageMap from './src/data/local-image-map';
// @ts-ignore: The external image map should be available in the Astro site that uses this integration
import externalImageMap from './src/data/external-image-map';

interface Props extends HTMLAttributes<'img'> {}

const { alt, class: className, src, title } = Astro.props;

// Validate props
if (!src) throw new Error('ImageTag requires a src prop for the image src attribute.');
if (!alt) throw new Error(`ImageTag requires an alt prop for the image alt text.\nsrc: ${src}`);

// Get the image width and height from the corresponding image map
const { width, height } = getImageData(src, localImageMap, externalImageMap);

// Get the image url by replacing the local:// or external:// prefix with the correct images directory path
const cSrc = getImageUrl(src);
---

<img class={className} src={cSrc} width={width} height={`${height}`} alt={alt} title={title} />
